# üìù –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

## –û–ø–∏—Å–∞–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ SQLite –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
**–§–∞–π–ª:** `data/text_messages.db`  
**–¢–∞–±–ª–∏—Ü–∞:** `text_messages`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã:
```sql
CREATE TABLE text_messages (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,                -- Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    username TEXT,                           -- Username (–±–µ–∑ @)
    first_name TEXT,                         -- –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    last_name TEXT,                          -- –§–∞–º–∏–ª–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
    chat_id INTEGER,                         -- ID —á–∞—Ç–∞
    message_text TEXT NOT NULL,              -- –ü–û–õ–ù–´–ô —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
    message_type TEXT DEFAULT 'text',        -- –¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    is_admin BOOLEAN DEFAULT 0,              -- –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –∞–¥–º–∏–Ω–æ–º
    user_state TEXT,                         -- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–æ—Ç–µ
    message_length INTEGER,                  -- –î–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
    has_mentions BOOLEAN DEFAULT 0,          -- –ï—Å—Ç—å –ª–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è (@)
    has_urls BOOLEAN DEFAULT 0               -- –ï—Å—Ç—å –ª–∏ —Å—Å—ã–ª–∫–∏
);
```

## üìä –¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π
- **`text`** - –æ–±—ã—á–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- **`command`** - –∫–æ–º–∞–Ω–¥—ã (–Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å `/`)
- **`admin_input`** - –≤–≤–æ–¥ –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
- **`search_query`** - –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- **`feedback`** - —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
- **`broadcast_input`** - –≤–≤–æ–¥ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏

## üîß –î–æ—Å—Ç—É–ø –∫ –ª–æ–≥–∞–º (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

### –ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å `/admin` ‚Üí **"üìù –õ–æ–≥–∏ —Ç–µ–∫—Å—Ç–æ–≤"**

#### üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤**
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ 24 —á–∞—Å–∞
- –†–∞–∑–±–∏–≤–∫–∞ –ø–æ —Ç–∏–ø–∞–º —Å–æ–æ–±—â–µ–Ω–∏–π
- –¢–æ–ø-5 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### üîç **–ü–æ–∏—Å–∫ –≤ —Ç–µ–∫—Å—Ç–∞—Ö**
- –ü–æ–∏—Å–∫ –ø–æ –ª—é–±–æ–º—É —Å–ª–æ–≤—É –∏–ª–∏ —Ñ—Ä–∞–∑–µ
- –ü–æ–∫–∞–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- –í—ã–¥–µ–ª–µ–Ω–∏–µ –∏—Å–∫–æ–º—ã—Ö —Å–ª–æ–≤
- –î–æ 20 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

#### üë§ **–°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
- –ò—Å—Ç–æ—Ä–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π
- –° –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏ –∏ —Ç–∏–ø–∞–º–∏
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏—è

#### üìã **–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è**
- 20 —Å–∞–º—ã—Ö —Å–≤–µ–∂–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –≤—Å–µ—Ö
- –í—Ä–µ–º—è, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Ç–∏–ø, —Ç–µ–∫—Å—Ç
- –û—Ç–º–µ—Ç–∫–∏ –∞–¥–º–∏–Ω–æ–≤ üëë
- –°–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –æ–±–∑–æ—Ä–∞

## üßπ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∞–º–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
```python
# –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
text_logger.cleanup_old_messages(days=30)
```

### –ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
- **üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
- **üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π** - –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞  
- **üìä –ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞–∑–º–µ—Ä –±–∞–∑—ã** - —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å

### –ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è:
‚úÖ **–ü–û–õ–ù–´–ô —Ç–µ–∫—Å—Ç** –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π  
‚úÖ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –≤—Ä–µ–º—è, —Ç–∏–ø)  
‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–æ—Ç–µ  
‚úÖ –ê–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ (–¥–ª–∏–Ω–∞, —Å—Å—ã–ª–∫–∏, —É–ø–æ–º–∏–Ω–∞–Ω–∏—è)

### –ó–∞—â–∏—Ç–∞:
- –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ (–±–µ–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π)

## üìà –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:
```sql
-- –°–∞–º—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
SELECT user_id, username, COUNT(*) as msg_count 
FROM text_messages 
GROUP BY user_id 
ORDER BY msg_count DESC;

-- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ —á–∞—Å–∞–º
SELECT strftime('%H', timestamp) as hour, COUNT(*) 
FROM text_messages 
GROUP BY hour 
ORDER BY hour;

-- –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
SELECT * FROM text_messages 
WHERE message_text LIKE '%–æ—à–∏–±–∫–∞%' 
ORDER BY timestamp DESC;
```

## üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –ª–æ–≥–∏—Ä—É–µ—Ç:
- ‚úÖ –í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –≤–≤–æ–¥
- ‚úÖ –ü–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ –û–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å
- ‚úÖ –í–≤–æ–¥ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏

## üìÅ –§–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã

- **`services/text_logging_service.py`** - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å
- **`toolbot/handlers/admin.py`** - –∞–¥–º–∏–Ω—Å–∫–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- **`toolbot/handlers/text_handler.py`** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- **`data/text_messages.db`** - SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

1. **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É** –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–∏—Å–∫** –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∂–∞–ª–æ–± –∏ –ø—Ä–æ–±–ª–µ–º
3. **–û—á–∏—â–∞–π—Ç–µ —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏** —Ä–∞–∑ –≤ –º–µ—Å—è—Ü
4. **–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π** –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –±–æ—Ç–∞
5. **–°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ä–∞–∑–º–µ—Ä–æ–º –±–∞–∑—ã** –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞. 